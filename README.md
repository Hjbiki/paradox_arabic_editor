# محرر نصوص بارادوكس

<div align="center">

![HTML5](https://img.shields.io/badge/html5-%23E34F26.svg?style=for-the-badge&logo=html5&logoColor=white)
![CSS3](https://img.shields.io/badge/css3-%231572B6.svg?style=for-the-badge&logo=css3&logoColor=white)
![JavaScript](https://img.shields.io/badge/javascript-%23323330.svg?style=for-the-badge&logo=javascript&logoColor=%23F7DF1E)
![GitHub Pages](https://img.shields.io/badge/github%20pages-121013?style=for-the-badge&logo=github&logoColor=white)

</div>

أداة متقدمة لمراجعة وتعديل ترجمات ألعاب Paradox مع دعم الترجمة الآلية والنسخ السريع.

## 🔗 **رابط الوصول المباشر:**
### **👉 [اضغط هنا لفتح محرر نصوص بارادوكس](https://hjbiki.github.io/paradox_arabic_editor/)**

## 🎯 لماذا هذا المحرر؟

فريق **رحلة للتعريب** يستخدم الذكاء الاصطناعي لترجمة الألعاب، لكن النتائج تحتاج مراجعة وتعديل يدوي. هذا المحرر يسهل عملية المراجعة ويوفر أدوات ترجمة متقدمة.

## 🚀 الاستخدام السريع

1. **افتح الموقع** في المتصفح
2. **اضغط "فتح ملف"** واختر أي ملف تريد تعديله
3. **ضع الملف الإنجليزي المطابق** في مجلد `english` للمقارنة (اختياري)
4. **أدخل مفاتيح API** للترجمة الآلية من زر "إعدادات API"
5. **ابحث** عن النص المطلوب تعديله
6. **راجع النص الإنجليزي المرجعي** في الأعلى
7. **استخدم الترجمة الآلية** أو **اكتب الترجمة يدوياً**
8. **انسخ النصوص** بسهولة باستخدام أيقونات النسخ
9. **احفظ** الملف المُحدث

## ✨ المميزات الأساسية

### 🔍 **البحث والتنقل**
- **بحث سريع** في النصوص
- **تنقل بين الترجمات** بالأزرار أو لوحة المفاتيح

### ✏️ **التحرير والتعديل**
- **تعديل مباشر** لأي ملف YAML
- **📊 تتبع التعديلات** (الأصفر = تم التعديل)
- **💾 حفظ تلقائي** في الذاكرة المحلية

### 🇬🇧 **المراجع الإنجليزية**
- **عرض النص الإنجليزي المرجعي** من مجلد `english`
- **🔧 مقارنة المفاتيح** مع المرجع الإنجليزي

### 🤖 **الترجمة الآلية** (محسّن!)
- **🎁 MyMemory** - **مجاني تماماً** ويعمل بدون مشاكل على GitHub Pages + تشخيص متقدم
- **Claude (Anthropic)** - أدق الترجمات للنصوص المعقدة
- **ChatGPT (OpenAI)** - ترجمة طبيعية ومتدفقة  
- **Gemini (Google)** - ترجمة سريعة ودقيقة
- **DeepL** - ترجمة متخصصة للنصوص الأوروبية
- **Google Translate** - ترجمة سريعة للاستخدام العام
- **تحديث تلقائي** للمحرر مع تأكيد النجاح
- **دعم وضع البلوكات** - استخراج النص الأصلي من البلوكات تلقائياً

### 📋 **النسخ السريع** (جديد!)
- **أيقونات نسخ** في زوايا جميع النصوص
- **نسخ المفتاح** للبحث أو المرجع
- **نسخ النص المرجعي** للمقارنة
- **نسخ الترجمة** للاستخدام الخارجي

### 🧩 **وضع البلوكات** (محسّن للأوامر الأكثر تعقيداً!)
- **تحويل الأوامر** `[COMMAND]` و `[county_control|E]` لبلوكات منفصلة
- **دعم الأوامر المعقدة جداً** مثل:
  - `[GetVassalStance( 'belligerent' ).GetName]`
  - `[attacker.MakeScope.ScriptValue('number_of_glory_hound_vassals')|V0]`
  - `[AddLocalizationIf( GreaterThan_int32( TraitLevelTrackEntry.GetLevel, '(int32)1' ), 'MODIFIER_PREVIOUS_LEVELS_APPLY_NEWLINE' )]`
- **إصلاح التكرار** - لا مزيد من ظهور البلوكات مكررة مع رموز ">"
- **تحويل أسطر جديدة** `\n` لبلوكات منفصلة (فقط عند التركيز على المحرر)
- **تمييز بصري** للأوامر والمتغيرات والأيقونات
- **البلوكات الحمراء** في النص المرجعي لإظهار المفقود من الترجمة
- **🔴 مفاتيح الترجمة الحمراء** - تلوين تلقائي للمفاتيح التي تحتوي على بلوكات مفقودة
- **تحليل ذكي متقدم** يتعامل مع 14 نوع مختلف من أنماط الأوامر

### 📐 **تحكم محسّن في الواجهة** (محدث!)
- **11 خيار لحجم النص** من 10px (صغير جداً) إلى 32px (عملاق جداً)
- **تغيير الحجم يدوياً** بالسحب العمودي على حواف الصناديق (بدلاً من dropdown)
- **حدود ذكية** للارتفاع (6rem كحد أدنى، 30rem كحد أقصى)
- **تطبيق فوري** للتغييرات على وضع البلوكات والوضع العادي
- **واجهة مبسطة** - إزالة عرض المفتاح (موجود في القائمة أصلاً)

## 📁 تنظيم الملفات

```
project/
├── index.html          # المحرر
├── script.js
├── styles.css
├── english/            # ملفات المقارنة الإنجليزية
│   ├── core_l_english.yml
│   ├── gui_l_english.yml
│   └── ...
└── your-file.yml       # الملف الذي ترفعه للتعديل
```

## ⚙️ إعداد خدمات الترجمة

### 🔑 الحصول على مفاتيح API

1. **Claude (Anthropic)**
   - اذهب إلى: [console.anthropic.com](https://console.anthropic.com/)
   - أنشئ حساب وتوجه إلى API Keys
   - أنشئ مفتاح جديد

2. **ChatGPT (OpenAI)**
   - اذهب إلى: [platform.openai.com/api-keys](https://platform.openai.com/api-keys)
   - سجل دخول وأنشئ مفتاح API جديد

3. **Gemini (Google)**
   - اذهب إلى: [makersuite.google.com/app/apikey](https://makersuite.google.com/app/apikey)
   - أنشئ مفتاح API مجاني

4. **DeepL**
   - اذهب إلى: [deepl.com/pro-api](https://www.deepl.com/pro-api)
   - اشترك في الخطة المجانية أو المدفوعة

5. **Google Translate**
   - اذهب إلى: [console.cloud.google.com](https://console.cloud.google.com/)
   - فعّل Cloud Translation API

### 📱 **كيفية الاستخدام**

1. **اضغط "إعدادات API"** في الرأس
2. **أدخل مفاتيح الخدمات** التي تريد استخدامها
3. **احفظ الإعدادات**
4. **اختر الخدمة المفضلة** من القائمة المنسدلة
5. **اضغط "ترجم"** لترجمة النص المرجعي تلقائياً

## ⌨️ اختصارات لوحة المفاتيح

- **Ctrl + S**: حفظ الملف
- **Ctrl + T**: ترجمة النص الحالي
- **Ctrl + B**: تفعيل/إيقاف وضع البلوكات
- **Shift + Enter**: إضافة سطر جديد `\n` في مكان الكتابة
- **سحب يدوي**: تغيير ارتفاع الصناديق (بدلاً من Ctrl+H)
- **Escape**: إغلاق النوافذ المنبثقة وإخفاء الإشعارات
- **النقر على الإشعار**: إخفاء الإشعار فوراً

## 💡 نصائح للاستخدام

### 🤖 **للترجمة الآلية:**
- **ابدأ بـ MyMemory** - مجاني ويعمل فوراً بدون إعداد
- **الترجمة تُحدث الواجهة فوراً** - لا تحتاج للخروج والدخول مرة أخرى
- **الترجمة تعمل مع كل النصوص** - حتى بعد الانتقال بين النصوص المختلفة
- **إذا لم تعمل الترجمة** - افتح Console (F12) واكتب `testMyMemoryTranslation()`
- **إذا لم تُحدث الواجهة** - افتح Console (F12) واكتب `testUIUpdate()`
- **إذا الترجمة تعمل مرة واحدة فقط** - افتح Console (F12) واكتب `testRepeatedTranslation()`
- **إذا علق إشعار يمنعك من الضغط** - اضغط Escape أو `hideNotification()`
- **للخدمات الأخرى** - أدخل مفاتيح API في "إعدادات API"
- **اضغط "ترجم"** أو **Ctrl+T** لترجمة النص المرجعي

### 🎯 **للحصول على أفضل ترجمة:**
1. **استخدم Claude** للنصوص المعقدة والطويلة
2. **استخدم ChatGPT** للنصوص الطبيعية والحوارات
3. **استخدم DeepL** للنصوص الأوروبية
4. **راجع الترجمة دائماً** وعدّلها حسب السياق

### 📋 **للنسخ السريع:**
- **انقر على أيقونة النسخ** بجانب أي نص
- **استخدم النسخ** لمقارنة النصوص في تطبيقات أخرى

### 🔍 **للبحث الفعال:**
- **ابحث بالمفاتيح** للعثور على مصطلح محدد
- **ابحث بالنص** للعثور على ترجمة معينة

### 🧩 **لوضع البلوكات:**
- **اضغط "وضع البلوكات"** أو **Ctrl+B** للتفعيل
- **لاحظ البلوكات الحمراء** في النص المرجعي للعناصر المفقودة
- **لاحظ 🔴 المفاتيح الحمراء** في قائمة الترجمات - تعني وجود بلوكات مفقودة
- **استخدم "+ سطر"** أو **Shift+Enter** لإضافة `\n` في المكان المحدد (فقط عند التركيز على المحرر)
- **يدعم الأوامر المعقدة جداً** مثل `[GetVassalStance( 'belligerent' ).GetName]`
- **لا مزيد من التكرار** - كل أمر يظهر مرة واحدة فقط

### 📐 **للتحكم في أحجام الصناديق:**
- **اسحب من الزاوية السفلية** لأي صندوق نص لتغيير ارتفاعه
- **الحد الأدنى**: 6rem (مناسب للنصوص القصيرة)
- **الحد الأقصى**: 30rem (للنصوص الطويلة جداً)
- **مرونة كاملة** - غير محدود بخيارات dropdown

### 🔔 **للتعامل مع الإشعارات:**
- **الإشعارات تختفي تلقائياً** بعد 4 ثوان
- **إذا علق إشعار** - اضغط عليه أو اضغط Escape
- **لاختبار الإشعارات** - افتح Console (F12) واكتب `testNotifications()`
- **للإخفاء الفوري** - افتح Console (F12) واكتب `hideNotification()`

## 🛠️ استكشاف الأخطاء وإصلاحها

### 🐛 **مشاكل شائعة وحلولها:**

#### **الترجمة تعمل مرة واحدة فقط ثم تتوقف عند الانتقال لنص آخر**
✅ **تم حل هذه المشكلة!** إذا واجهتها:
1. افتح Console (F12)
2. اكتب `simulateUserIssue()` لمحاكاة المشكلة واختبار الحل
3. اكتب `quickTranslationTest()` للاختبار السريع
4. إذا مازالت المشكلة موجودة، أعد تحميل الصفحة

#### **"خطأ في تحليل YAML: Cannot set properties of null"**
✅ **تم إصلاح هذه المشكلة!** العناصر DOM محمية الآن بـ null checks

#### **"insertNewline: التركيز ليس على المحرر"**
✅ **تم إصلاح هذه المشكلة!** الآن يركز تلقائياً على المحرر

#### **MyMemory يترجم لكن يحتاج خروج ودخول لرؤية النص**
✅ **تم إصلاح هذه المشكلة!** الآن يُحدث الواجهة فوراً:
- إطلاق `input` و `change` events تلقائياً
- تحديث حالة "تم التعديل" فوراً
- تحديث preview في قائمة الترجمات
- تحديث الإحصائيات والأزرار
- فحص النص الأصلي من وضع البلوكات أيضاً
- تشخيص مفصل في Console (F12)

#### **الترجمة تعمل مرة واحدة فقط، ثم لا تحدث الواجهة عند الانتقال لنص آخر**
✅ **تم إصلاح هذه المشكلة!** إصلاح شامل لتحديث الواجهة:
- إطلاق events في `selectTranslationByIndex` عند تغيير النص
- إعادة ربط `translationText` element للتأكد من المرجع الصحيح
- فحص مستمر لصحة العناصر قبل وأثناء الترجمة
- تحديث الواجهة يعمل بشكل موثوق عند كل انتقال
- رسائل تشخيص مفصلة في Console للمتابعة

#### **الإشعارات تعلق ولا تختفي، تمنع الضغط على الأزرار**
✅ **تم إصلاح هذه المشكلة!** نظام إشعارات محسن:
- إخفاء تلقائي بعد 4 ثوان
- إخفاء فوري بالضغط على الإشعار
- إخفاء بـ Escape من لوحة المفاتيح
- تنظيف كامل للـ DOM وإزالة حجب الأزرار
- منع تداخل الإشعارات

#### **أخطاء CORS عند استخدام APIs**
- استخدم **MyMemory** (مجاني بدون API)
- أو نزّل CORS extension للمتصفح

#### **الملف لا يُحمل على GitHub Pages**
- تأكد من أن الملف بصيغة `.yml` أو `.yaml`
- تأكد من وجود قسم `l_english:` في الملف

### 🧪 **دوال اختبار مفيدة:**
افتح Console (F12) واستخدم هذه الدوال:
```javascript
testNullElementsFix()      // اختبار العناصر DOM
testInsertNewline()        // اختبار إدراج \n
testMyMemoryTranslation()  // اختبار ترجمة MyMemory (جديد!)
testUIUpdate()            // اختبار تحديث الواجهة (جديد!)
testNotifications()       // اختبار الإشعارات (جديد!)
testRepeatedTranslation() // اختبار الترجمة المتكررة (جديد!)
testComplexCommands()      // اختبار الأوامر المعقدة
testLatestFixes2()        // اختبار الإصلاحات الأحدث (جديد!)
testAllLatestFixes()      // اختبار شامل للإصلاحات الجديدة (جديد!)
finalComprehensiveTest()   // اختبار شامل

// دوال الإصلاح السريع:
hideNotification()         // إخفاء أي إشعار معلق فوراً
quickTranslationTest()     // اختبار سريع للترجمة المتكررة
simulateUserIssue()       // محاكاة دقيقة لمشكلة المستخدم
```

## 👨‍💻 للمطورين

الملفات المطلوبة:
- `index.html` - الصفحة الرئيسية
- `styles.css` - التصميم
- `script.js` - الوظائف

### الميزات التقنية:
- **API متعددة** للترجمة الآلية مع إدارة CORS محسنة
- **Clipboard API** للنسخ السريع بتأكيد بصري
- **LocalStorage** لحفظ الإعدادات والتقدم تلقائياً
- **Regex متقدم جداً** - 14 نمط مختلف للأوامر من البسيطة `[culture]` إلى المعقدة `[AddLocalizationIf(...)]`
- **CSS resize** للتحكم اليدوي في أحجام الصناديق بدلاً من dropdown
- **تلوين ديناميكي** للمفاتيح التي تحتوي على بلوكات مفقودة (🔴 أحمر مع أيقونة ⚠️)
- **focus management** متقدم لمنع إدراج `\n` خارج المحرر
- **DOM safety** - جميع العناصر محمية بـ null checks لمنع أخطاء GitHub Pages
- **Dynamic element rebinding** - إعادة ربط العناصر تلقائياً عند فقدان المرجع
- **UI consistency** - ضمان تحديث الواجهة في جميع الحالات بـ event dispatching
- **Translation state management** محسن للعمل مع تغيير النصوص المتكرر
- **Notification system** محسن مع منع التعليق وإخفاء فوري
- **Event management** متقدم مع تنظيف timeouts وmemory leaks
- **Error handling** محسن مع `safeTimeout` و `safeAsync` لمنع أخطاء الكونسول
- **DOMContentLoaded** - تحميل العناصر بعد جاهزية DOM للحصول على أقصى توافق
- **DOM optimization** مع إزالة العناصر غير الضرورية (keyDisplay)
- **CSS Grid/Flexbox** لواجهة متجاوبة ومرنة
- **Responsive Design** يعمل على جميع أحجام الشاشات

---

## 🔧 **البنية التقنية الجديدة - v2.0 (ديسمبر 2024)**

تم إعادة هيكلة المشروع من ملف JavaScript واحد ضخم (4236+ سطر) إلى **بنية منطقية ومنظمة**:

### 📁 **هيكل الملفات الجديد:**

```
js/
├── core/               # النواة الرئيسية
│   ├── globals.js     # المتغيرات العامة
│   └── main.js        # التهيئة الرئيسية
├── file-handling/      # معالجة الملفات
│   ├── yaml-loader.js # تحميل ملفات YAML
│   └── file-operations.js # عمليات الحفظ والتحديث
├── translation/        # خدمات الترجمة
│   ├── services.js    # جميع خدمات الترجمة
│   └── translation-ops.js # العمليات الأساسية
├── ui/                # واجهة المستخدم
│   ├── blocks-mode.js # وضع البلوكات التفاعلية
│   ├── controls.js    # أزرار التحكم والتنقل
│   └── notifications.js # الإشعارات والتحديثات
├── utils/             # الأدوات المساعدة
│   ├── helpers.js     # دوال مساعدة عامة
│   ├── storage.js     # التخزين المحلي
│   └── safety.js      # دوال الأمان
└── tests/
    └── test-functions.js # دوال الاختبار والتشخيص
```

### 🎯 **فوائد البنية الجديدة:**

✅ **أداء محسن** - تحميل أسرع وذاكرة أقل  
✅ **صيانة أسهل** - كل ميزة في ملف منفصل  
✅ **قابلية التطوير** - إضافة ميزات جديدة بسهولة  
✅ **أمان أفضل** - فصل المسؤوليات وإدارة أفضل للأخطاء  
✅ **توافق كامل** - نفس الوظائف مع GitHub Pages  

### 🔄 **التحديثات الرئيسية:**

- **إدارة محسنة للمتغيرات العامة** عبر `globals.js`
- **نظام إشعارات متطور** مع تحسينات UI/UX
- **معالجة ملفات محسنة** مع safety checks
- **دوال اختبار شاملة** للتشخيص السريع
- **Block mode متقدم** لمعالجة الأوامر المعقدة

---

**💡 تم تطوير هذا المشروع من قبل [عناد عسكر](https://dkn.to/hibiki) لفريق رحلة للتعريب** 